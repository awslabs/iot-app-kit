import { Meta, Canvas, Story } from '@storybook/addon-docs';

import { ViewportManager, ViewportControls } from '../'

<Meta title="Components/ViewportManager" component={ViewportManager} />

# Viewport Manager

The `ViewportManager` is a top level component used to control a viewport for a collection of dashboard widgets.

<Canvas>
  <Story name="With Controls">
    <ViewportManager>
      <ViewportControls
        relativeOptions={[
          {
            key: "previous-5-minutes",
            amount: 5,
            unit: "minute",
            type: "relative"
          },
          {
            key: "previous-30-minutes",
            amount: 30,
            unit: "minute",
            type: "relative"
          },
          {
            key: "previous-1-hour",
            amount: 1,
            unit: "hour",
            type: "relative"
          },
          {
            key: "previous-6-hours",
            amount: 6,
            unit: "hour",
            type: "relative"
          }
        ]}
        isValidRange={range => {
          if (range?.type === "absolute") {
            const [
              startDateWithoutTime
            ] = range.startDate.split("T");
            const [
              endDateWithoutTime
            ] = range.endDate.split("T");
            if (
              !startDateWithoutTime ||
              !endDateWithoutTime
            ) {
              return {
                valid: false,
                errorMessage:
                  "The selected date range is incomplete. Select a start and end date for the date range."
              };
            }
            if (
              Number(new Date(range.startDate)) - Number(new Date(range.endDate)) >
              0
            ) {
              return {
                valid: false,
                errorMessage:
                  "The selected date range is invalid. The start date must be before the end date."
              };
            }
          }
          return { valid: true };
        }}
        i18nStrings={{
          todayAriaLabel: "Today",
          nextMonthAriaLabel: "Next month",
          previousMonthAriaLabel: "Previous month",
          customRelativeRangeDurationLabel: "Duration",
          customRelativeRangeDurationPlaceholder:
            "Enter duration",
          customRelativeRangeOptionLabel: "Custom range",
          customRelativeRangeOptionDescription:
            "Set a custom range in the past",
          customRelativeRangeUnitLabel: "Unit of time",
          formatRelativeRange: e => {
            const n =
              1 === e.amount ? e.unit : `${e.unit}s`;
            return `Last ${e.amount} ${n}`;
          },
          formatUnit: (e, n) => (1 === n ? e : `${e}s`),
          dateTimeConstraintText:
            "Range is 6 to 30 days. For date, use YYYY/MM/DD. For time, use 24 hr format.",
          relativeModeTitle: "Relative range",
          absoluteModeTitle: "Absolute range",
          relativeRangeSelectionHeading: "Choose a range",
          startDateLabel: "Start date",
          endDateLabel: "End date",
          startTimeLabel: "Start time",
          endTimeLabel: "End time",
          clearButtonLabel: "Clear and dismiss",
          cancelButtonLabel: "Cancel",
          applyButtonLabel: "Apply"
        }}
        placeholder="Filter by a date and time range" />
    </ViewportManager>
  </Story>
</Canvas>
