import { Canvas, Meta, Story } from '@storybook/blocks';
import * as BarChartStories from './BarChart.stories';

<Meta of={BarChartStories} />

# Bar Chart

The Bar Chart component is a powerful visualization tool that displays time-series data from one or more [data sources](http://localhost:6006/?path=/docs/core-datasources--docs). It supports a wide range of features, including alarms, thresholds, high-performance live-streaming, and smooth synchronization with other IoT App Kit components.
The Bar Chart is rendered via WebGL and users **must** include the WebGL Context for chart to properly render.

## Demo

<Canvas  story={{height : '400px' }}  sourceState="none" of={BarChartStories.Standard} />

**ðŸ“ˆðŸ‘† Interact with the chart!**

**_Pan_**: hold shift, click and drag within the data-visualization area of the chart.

**_Zoom in_**: double-click on a position within the data visualization area of the chart.

**_Zoom out:_** hold shift and double-click on a position within a chart to zoom away from that area.

**_Restrict time span_:** click and drag through the interval of time you wish to restrict the viewport to.

---

## Bar Chart Properties

The bar chart component contains the following properties.

**queries** (array): An array of queries that specify the time-series data to visualize. [Learn more about time series data queries](/docs/core-time-series-data--docs).

**viewport** (object, optional): Specifies the interval of time the widget visualizes. If a value is not provided, it utilizes the `viewport` specified by its [ViewportManager](http://localhost:6006/?path=/docs/components-viewportmanager--docs). If there is no ViewportManager and no `viewport` defined, the default viewport will be `{ duration: '10d' }`.  [Learn more about viewports](/docs/core-viewport--docs).

**thresholds** (object, optional): Thresholds define rules that affect how the data is visualized based on whether the data breaches the threshold. [Learn more about thresholds](/docs/core-thresholds--docs#thresholds).

**thresholdSettings** (object, optional): Customize settings on how thresholds are visualized within the widget. Defaults to `{ colorBreachedData: true }`. [Learn more about thresholds settings](/docs/core-thresholds--docs#thresholdsettings).

**yMin** (number, optional): Minimum y value displayed on component. Defaults to automatically determining yMin based on data present within the `viewport`.

**yMax** (number, optional):  Maximum y value displayed on component. Defaults to automatically determining yMax based on data present within the `viewport`.

**gestures** (boolean, optional): Specifies whether gestures (pan, zoom and restrict time-span) are enabled. Defaults to `true`.

**axis** (object, optional): Specifies x and y-axis related settings. Defaults to `{ showX: true, showY: true, yAxisLabel: undefined }`.

  Properties:

  * `showX` (boolean, optional): Determines whether to show the x-axis. Defaults to true.

  * `showY` (boolean, optional): Determines whether to show the y-axis and the horizontal grid lines. Defaults to true.

  * `yAxisLabel` (string, optional): The y-axis label content. Defaults to empty.

**styles** (object, optional): The styles prop lets you customize the appearance of each data stream based on its `refId` or [reference ID](/docs/core-styles--docs). 

  Properties:

  *  `name` (string, optional): Specify a name to replace the name of the data set given by its source.

  *  `unit` (string, optional): The unit given to the data (for example, `m/s` and `count`).

  *  `color` (string, optional): A detailed name presented in the tooltip.
  
---

### Example Bar Chart Implementation

```jsx
import { BarChart, WebglContext } from '@iot-app-kit/react-components';
import { initialize } from '@iot-app-kit/source-iotsitewise';


const Page = () => {
  const iotSiteWiseQuery = initialize({
    iotSiteWiseClient, // create an instance of the sitewise client
    iotEventsClient, // create an instance of the events client
  });

  const barChartQuery = iotSiteWiseQuery.timeSeriesData({ 
    assets: [{
      assetId: 'id', 
      properties: [{ propertyId: 'property', refId: 'my-property' }]
    }]
  })


  <div>
    <BarChart 
      /** Providing a query with ref-id of 'my-property' */
      queries={[barChartQuery]}  
      
      /** Mapping the provided 'my-property' refId to the bar chart style settings */
      styles={{ 'my-property': { color: 'red', name: 'My Cool Property' }}}

      /** Customizing the axis to hide x-axis, show y-axis, and set y-axis label */
      axis={{ showX: false, showY: true, yAxisLabel: 'mph' }}
    />

    /** WebglContext is must be present for chart to render. */
    /** Note you only need one WebglContext per project. Do not add one per chart. */
    <WebglContext />
  </div>
};
```




---

**value (object)** : An object containing the raw data and optional style overrides. It has the following properties:

  - **data** (object): An object that represents the data in a columnar table by using fields, where each field represents a column in a table, and a value in the field represents a cell in the table row for that field. The fields together represent a single Diagnostic event with a timestamp and Diagnostic values.

    - **name** (string optional): the name of the data frame

    - **fields** (array): An array of objects where each object describes one column in the table with the following properties:

      - **name** (string): the name of the column, which should be either `time, prediction_reason, prediction, quality, anomaly_score, or <diagnostic name>` 

      - **type** (string): the data type of the column, which should be either `time, number, or string`.

      - **values** (array): an array of table values whose types are the same as the type property.

    - **length** (number): the number of rows in the columnar table

  - **styles** (object, optional): An object that overrides global style settings. It can have the following properties:

    - **decimalPlaces** (number, optional): Defines the number of decimal places to display for the diagnostic values.

    - **color** (array, optional): An array representing the color palette used to render the diagnostics.


### Example 

Here's an example of the Anomaly chart data structure:

```
{
  state: 'success',
  value: {
    styles: {
      // defines the color pallette for the diagnostics
      color: ['pink', 'blue', 'green', 'red'],
    },
    data: {
      fields: [
        {
          name: 'time',
          type: FieldType.time,
          values: [1714676404000, 1714676405000, 1714676407000, 1714676408000],
        },
        {
          name: 'prediction_reason',
          type: FieldType.string,
          values: [
            'ANOMALY_DETECTED',
            'ANOMALY_DETECTED',
            'ANOMALY_DETECTED',
            'ANOMALY_DETECTED',
          ],
        },
        {
          name: 'Diagnostic 1',
          type: FieldType.number,
          values: [0.27978, 0.2796, 0.27943, 0.27925],
        },
        {
          name: 'Diagnostic 2',
          type: FieldType.number,
          values: [0.10742, 0.10739, 0.10735, 0.10731],
        },
        {
          name: 'Diagnostic 3',
          type: FieldType.number,
          values: [0.21679, 0.21717, 0.21754, 0.21792],
        },
      ],
      length: 4,
      name: 'Diagnostic Data Frame',
    }
  },
};
```

In this example, the state is 'success', indicating that the data was loaded successfully. The value object contains four diagnostic events, represented by index across the values of each field. Each diagnostic field object has a name and values between 0 and 1. The styles object overrides the global color palette for rendering the diagnostics, specifying an array of colors (['pink', 'blue', 'green', 'red']).